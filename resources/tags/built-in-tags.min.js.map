{"version":3,"sources":["built-in-tags.js"],"names":["window","$","undefined","treeNodeTmpl","templates","treeTmpl","tabsTmpl","tabsTag","init","tagCtx","this","selectedIndex","props","selectedTab","tabCount","tagCtxs","length","parents","section","page","tabs","render","index","activateTabs","self","contents","first","on","setTab","view","template","observable","setProperty","onSelectionChange","treeTag","parent","setTree","ctx","tree","onAfterLink","tag","select","ev","toggle","stopImmediatePropagation","remove","addCategory","moveCategoryUp","moveCategoryDown","hideCategory","_newNodeCounter","treeNode","data","editedNode","editable","selected","treeNodeTag","ctxPrm","expanded","onExpansionChange","childNodes","contentArray","categories","childTags","nodeData","insert","name","label","move","category","hidden","selectListTag","baseTag","onArrayChange","eventArgs","baseApply","arguments","change","toggleSelect","flow","item","onToggleSelect","child","selectedChild","depends","views","tags","selectList","jQuery"],"mappings":"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","file":"built-in-tags.min.js","sourcesContent":["(function(window, $, undefined) {\n\"use strict\";\n\n//#region TEMPLATES\n\nvar treeNodeTmpl = $.templates(\n\t\t\"{^{if !hidden || ~tree.editable}}<li data-link=\\\"class{:~tree.selected === #data ? 'selected' : 'unselected'}\\\">\" +\n\t\t\t\"{^{if categories && categories.length }}\" +\n\t\t\t\t\"<span class=\\\"toggle\\\">{^{:expanded ? '-' : '+' }}</span>\" +\n\t\t\t\"{{else}}\" +\n\t\t\t\t\"<span class=\\\"spacer\\\">&bull;</span>\" +\n\t\t\t\"{{/if}}\" +\n\t\t\t\"{^{if ~tree.editedNode(#data)}}\" +\n\t\t\t\t\"<button class=\\\"up cmdbtn\\\">up</button>\" +\n\t\t\t\t\"<button class=\\\"down cmdbtn\\\">down</button>\" +\n\t\t\t\t\"<button class=\\\"add cmdbtn\\\">add</button>\" +\n\t\t\t\t\"{{if ~parentTags.treeNode }}\" +\n\t\t\t\t\t\"<span class=\\\"remove\\\"></span>\" +\n\t\t\t\t\"{{/if}}\" +\n\t\t\t\t\"<button class=\\\"hide cmdbtn\\\" data-link=\\\"hidden ? 'show' : 'hide'\\\"></button>\" +\n\t\t\t\t\"<label>label: <input data-link=\\\"label\\\" /></label>\" +\n\t\t\t\t\"<label>name: <input data-link=\\\"name\\\" /></label>\" +\n\t\t\t\t\"<div class=\\\"bottom\\\"></div>\" +\n\t\t\t\"{{else}}\" +\n\t\t\t\t\"<span>{{>label}}</span>\" +\n\t\t\t\"{{/if}}\" +\n\t\t\"</li>\" +\n\t\t\"{^{if expanded }}\" +\n\t\t\t\"<li>\" +\n\t\t\t\t\"<ul>\" +\n\t\t\t\t\t\"{^{for categories }}\" +\n\t\t\t\t\t\t\"{^{treeNode/}}\" +\n\t\t\t\t\t\"{{/for}}\" +\n\t\t\t\t\"</ul>\" +\n\t\t\t\"</li>\" +\n\t\t\"{{/if}}{{/if}}\"),\n\n\ttreeTmpl  = $.templates(\n\n\t\t\"<ul class=\\\"tree\\\">\" +\n\t\t\t\"{^{for}}\" +\n\t\t\t\t\"{^{treeNode/}}\" +\n\t\t\t\"{{/for}}\" +\n\t\t\"</ul>\"),\n\n\ttabsTmpl  = $.templates(\n\n\t\t\"<table class=\\\"tabsview\\\"><tbody>\" +\n\t\t\t\"<tr class=\\\"tabstrip\\\">\" +\n\t\t\t\t\"{{for ~tag.tagCtxs }}\" +\n\t\t\t\t\t\"<th data-link=\\\"class{:'header_' + (#index === ~tag.selectedIndex)}\\\">\" +\n\t\t\t\t\t\t\"{{>props.tabCaption}}\" +\n\t\t\t\t\t\"</th>\" +\n\t\t\t\t\"{{/for}}\" +\n\t\t\t\"</tr>\" +\n\t\t\t\"<tr class=\\\"tabscontent\\\">\" +\n\t\t\t\t\"<td colspan=\\\"{{:~tag.tagCtxs.length}}\\\">\" +\n\t\t\t\t\t\"{^{for ^tmpl=~tag.tagCtxs[~tag.selectedIndex].content /}}\" +\n\t\t\t\t\"</td>\" +\n\t\t\t\"</tr>\" +\n\t\t\"</tbody></table>\"),\n\n//#endregion\n\n//#region TAG CONTROLS\n\n// {{tabs}}\n\n\ttabsTag = {\n\t\tinit: function(tagCtx) {\n\t\t\tthis.selectedIndex = tagCtx.props.selectedTab || 0;\n\t\t\tthis.tabCount = this.tagCtxs.length;\n\t\t\t(this.parents.section || this.parents.page).tabs = this;\n\t\t},\n\t\trender: function() {\n\t\t\tvar tagCtx = this.tagCtx;\n\t\t\treturn this.selectedIndex === tagCtx.index ? tagCtx.render() : \"\";\n\t\t},\n\t\tactivateTabs: function() {\n\t\t\tvar self = this;\n\t\t\tself.contents(true, \".tabstrip\").first()\n\t\t\t\t.on(\"click\", \".header_false\", function() {\n\t\t\t\t\tself.setTab($.view(this).index);\n\t\t\t\t});\n\t\t},\n\t\ttemplate: tabsTmpl,\n\n\t// methods\n\t\tsetTab: function(index) {\n\t\t\t$.observable(this).setProperty(\"selectedIndex\", index);\n\t\t\tif (this.onSelectionChange) {\n\t\t\t\tthis.onSelectionChange(index, this);\n\t\t\t}\n\t\t}\n\t},\n\n// {{tree}}\n\n\ttreeTag = {\n\t\tinit: function() {\n\t\t\tthis.parent.setTree(this);\n\t\t\tthis.ctx.tree = this; // Set contextual property ~tree\n\t\t},\n\t\tonAfterLink: function() {\n\t\t\tvar self = this;\n\t\t\tself.contents(\"ul\")\n\t\t\t\t.on(\"click\", \".selected, .unselected\", function() {\n\t\t\t\t\t$.view(this).ctx.tag.select();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".toggle\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.toggle();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".remove\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.remove();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".add\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.addCategory();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".up\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.moveCategoryUp();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".down\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.moveCategoryDown();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".hide\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.hideCategory();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t});\n\t\t},\n\t\ttemplate: treeTmpl,\n\n\t//PROPERTIES\n\t\t_newNodeCounter: 0,\n\n\t//METHODS\n\t\tselect: function(treeNode) {\n\t\t\t$.observable(this).setProperty(\"selected\", treeNode.data);\n\t\t\tif (this.onSelectionChange) {\n\t\t\t\tthis.onSelectionChange(treeNode.data);\n\t\t\t}\n\t\t},\n\t\teditedNode: function(treeNode) {\n\t\t\treturn this.editable && this.selected === treeNode;\n\t\t}\n\t},\n\n// {{treeNode}}\n\n\ttreeNodeTag = {\n\t\tinit: function(tagCtx) {\n\t\t\tthis.data = tagCtx.view.data;\n\t\t\tthis.tree = this.ctxPrm(\"tree\");\n\t\t},\n\t\ttemplate: treeNodeTmpl,\n\n\t// methods\n\t\ttoggle: function() {\n\t\t\t$.observable(this.data).setProperty(\"expanded\", !this.data.expanded);\n\t\t\tif (this.tree.onExpansionChange) {\n\t\t\t\tthis.tree.onExpansionChange(this.data);\n\t\t\t}\n\t\t},\n\t\tremove: function() {\n\t\t\tvar childNodes,\n\t\t\t\tparent = this.parent,\n\t\t\t\tcontentArray = parent.data.categories,\n\t\t\t\tindex = this.tagCtx.view.index;\n\t\t\t$.observable(contentArray).remove(index);\n\t\t\tchildNodes = parent.childTags();\n\t\t\tthis.tree.select(childNodes[index] || childNodes[index - 1] || parent);\n\t\t},\n\t\tselect: function() {\n\t\t\tif (this.tree.selected !== this.data) {\n\t\t\t\tthis.tree.select(this);\n\t\t\t}\n\t\t},\n\t\taddCategory: function() {\n\t\t\tvar childNodes,\n\t\t\t\tnodeData = this.data;\n\t\t\tnodeData.categories = nodeData.categories || [];\n\t\t\t$.observable(this.data.categories).insert({\n\t\t\t\tname: \"name\" + this.tree._newNodeCounter++,\n\t\t\t\tlabel: \"\"\n\t\t\t});\n\t\t\t$.observable(nodeData).setProperty(\"expanded\", true);\n\t\t\tchildNodes = this.childTags();\n\t\t\tthis.tree.select(childNodes[childNodes.length - 1]);\n\t\t},\n\t\tmoveCategoryUp: function() {\n\t\t\tvar index = this.tagCtx.view.index,\n\t\t\t\tcategories = this.parent.data.categories;\n\t\t\tif (index) {\n\t\t\t\t$.observable(categories).move(index, index-1);\n\t\t\t}\n\t\t},\n\t\tmoveCategoryDown: function() {\n\t\t\tvar index = this.tagCtx.view.index,\n\t\t\t\tcategories = this.parent.data.categories;\n\t\t\tif (index + 1 < categories.length) {\n\t\t\t\t$.observable(categories).move(index, index+1);\n\t\t\t}\n\t\t},\n\t\thideCategory: function() {\n\t\t\tvar category = this.parent.data.categories[this.tagCtx.view.index];\n\t\t\t$.observable(category).setProperty(\"hidden\", !category.hidden);\n\t\t}\n\t},\n\n// {{selectList}}\n// Derives from {{for}} control\n\n\tselectListTag = {\n\t\t// This tag control derives from the {{for}} tag.\n\t\tbaseTag: \"for\",\n\n\t\t// overrides of {{for}} tag.\n\n\t\tonArrayChange: function(ev, eventArgs) {\n\t\t\t// Call baseTag implementation\n\t\t\tthis.baseApply(arguments);\n\n\t\t\tif (eventArgs.change === \"insert\") {\n\t\t\t\tthis.toggleSelect(eventArgs.index);\n\t\t\t}\n\t\t},\n\t\tflow: false,\n\n\t\t// additional methods\n\n\t\ttoggleSelect: function(index) {\n\t\t\tthis.item(index).toggleSelect();\n\t\t},\n\t\titem: function(index) {\n\t\t\treturn this.childTags()[index];\n\t\t},\n\n\t\t// additional events\n\n\t\tonToggleSelect: function(child) {\n\t\t\tif (child === this.selectedChild) {\n\t\t\t\tthis.selectedChild = null;\n\t\t\t} else if (child.selected) {\n\t\t\t\tif (this.selectedChild) {\n\t\t\t\t\tthis.selectedChild.toggleSelect();\n\t\t\t\t}\n\t\t\t\tthis.selectedChild = child;\n\t\t\t}\n\t\t}\n\t};\n\n//#endregion\n\n//#region INITIALIZATION\n\ntreeTag.editedNode.depends = \"editable\";\n\n$.views.tags({\n\ttabs: tabsTag,\n\ttree: treeTag,\n\ttreeNode: treeNodeTag,\n\tselectList: selectListTag\n});\n\n//#endregion\n})(this, this.jQuery);\n"]}