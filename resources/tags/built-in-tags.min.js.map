{"version":3,"sources":["built-in-tags.js"],"names":["window","$","undefined","treeNodeTmpl","templates","treeTmpl","tabsTmpl","tabsTag","init","tagCtx","this","pane","props","selectedTab","tabCount","tagCtxs","length","parents","section","page","tabs","render","index","template","setTab","observable","setProperty","onSelectionChange","treeTag","parent","setTree","ctx","tree","onAfterLink","self","contents","on","view","tag","select","ev","toggle","stopImmediatePropagation","remove","addCategory","moveCategoryUp","moveCategoryDown","hideCategory","_newNodeCounter","treeNode","data","editedNode","editable","selected","treeNodeTag","ctxPrm","expanded","onExpansionChange","childNodes","contentArray","categories","childTags","nodeData","insert","name","label","move","category","hidden","selectListTag","baseTag","onArrayChange","eventArgs","baseApply","arguments","change","toggleSelect","flow","item","onToggleSelect","child","selectedChild","depends","views","tags","selectList","jQuery"],"mappings":"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","file":"built-in-tags.min.js","sourcesContent":["(function(window, $, undefined) {\n\"use strict\";\n\n//#region TEMPLATES\n\nvar treeNodeTmpl = $.templates(\n\t\t\"{^{if !hidden || ~tree.editable}}<li data-link=\\\"class{:~tree.selected === #data ? 'selected' : 'unselected'}\\\">\" +\n\t\t\t\"{^{if categories && categories.length }}\" +\n\t\t\t\t\"<span class=\\\"toggle\\\">{^{:expanded ? '-' : '+' }}</span>\" +\n\t\t\t\"{{else}}\" +\n\t\t\t\t\"<span class=\\\"spacer\\\">&bull;</span>\" +\n\t\t\t\"{{/if}}\" +\n\t\t\t\"{^{if ~tree.editedNode(#data)}}\" +\n\t\t\t\t\"<button class=\\\"up cmdbtn\\\">up</button>\" +\n\t\t\t\t\"<button class=\\\"down cmdbtn\\\">down</button>\" +\n\t\t\t\t\"<button class=\\\"add cmdbtn\\\">add</button>\" +\n\t\t\t\t\"{{if ~parentTags.treeNode }}\" +\n\t\t\t\t\t\"<span class=\\\"remove\\\"></span>\" +\n\t\t\t\t\"{{/if}}\" +\n\t\t\t\t\"<button class=\\\"hide cmdbtn\\\" data-link=\\\"hidden ? 'show' : 'hide'\\\"></button>\" +\n\t\t\t\t\"<label>label: <input data-link=\\\"label\\\" /></label>\" +\n\t\t\t\t\"<label>name: <input data-link=\\\"name\\\" /></label>\" +\n\t\t\t\t\"<div class=\\\"bottom\\\"></div>\" +\n\t\t\t\"{{else}}\" +\n\t\t\t\t\"<span>{{>label}}</span>\" +\n\t\t\t\"{{/if}}\" +\n\t\t\"</li>\" +\n\t\t\"{^{if expanded }}\" +\n\t\t\t\"<li>\" +\n\t\t\t\t\"<ul>\" +\n\t\t\t\t\t\"{^{for categories }}\" +\n\t\t\t\t\t\t\"{^{treeNode/}}\" +\n\t\t\t\t\t\"{{/for}}\" +\n\t\t\t\t\"</ul>\" +\n\t\t\t\"</li>\" +\n\t\t\"{{/if}}{{/if}}\"),\n\n\ttreeTmpl  = $.templates(\n\n\t\t\"<ul class=\\\"tree\\\">\" +\n\t\t\t\"{^{for}}\" +\n\t\t\t\t\"{^{treeNode/}}\" +\n\t\t\t\"{{/for}}\" +\n\t\t\"</ul>\"),\n\n\ttabsTmpl  = $.templates(\n\t\t'<table class=\"tabsview\"><tbody>' +\n\t\t\t// Tab strip UI with 'click' handler calling tag.setTab() method\n\t\t\t'<tr class=\"tabstrip\">' +\n\t\t\t\t'{{for ~tag.tagCtxs}}' +\n\t\t\t\t\t'<th data-link=\"class{:\\'header_\\' + (#index === ~tag.pane)} {on ~tag.setTab #index} {:props.tabCaption}\"></th>' +\n\t\t\t\t'{{/for}}' +\n\t\t\t'</tr>' +\n\t\t\t// Tab content with wrapped content of selected {{else}} block\n\t\t\t'<tr class=\"tabscontent\">' +\n\t\t\t\t'<td colspan=\"{{:~tag.tagCtxs.length}}\" data-link=\"{include ^tmpl=~tag.tagCtxs[~tag.pane].content}\"></td>' +\n\t\t\t'</tr>' +\n\t\t'</tbody></table>'),\n\n//#endregion\n\n//#region TAG CONTROLS\n\n// {{tabs}}\n\n\ttabsTag = {\n\t\tinit: function(tagCtx) {\n\t\t\tthis.pane = tagCtx.props.selectedTab || 0;\n\t\t\tthis.tabCount = this.tagCtxs.length;\n\t\t\t(this.parents.section || this.parents.page).tabs = this;\n\t\t},\n\t\trender: function() {\n\t\t\tvar tagCtx = this.tagCtx;\n\t\t\treturn this.pane === tagCtx.index ? tagCtx.render() : \"\";\n\t\t},\n\t\ttemplate: tabsTmpl,\n\n\t// methods\n\t\tsetTab: function(index) {\n\t\t\t$.observable(this).setProperty(\"pane\", index);\n\t\t\tif (this.onSelectionChange) {\n\t\t\t\tthis.onSelectionChange(index, this);\n\t\t\t}\n\t\t}\n\t},\n\n// {{tree}}\n\n\ttreeTag = {\n\t\tinit: function() {\n\t\t\tthis.parent.setTree(this);\n\t\t\tthis.ctx.tree = this; // Set contextual property ~tree\n\t\t},\n\t\tonAfterLink: function() {\n\t\t\tvar self = this;\n\t\t\tself.contents(\"ul\")\n\t\t\t\t.on(\"click\", \".selected, .unselected\", function() {\n\t\t\t\t\t$.view(this).ctx.tag.select();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".toggle\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.toggle();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".remove\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.remove();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".add\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.addCategory();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".up\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.moveCategoryUp();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".down\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.moveCategoryDown();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \".hide\", function(ev) {\n\t\t\t\t\t$.view(this).ctx.tag.hideCategory();\n\t\t\t\t\tev.stopImmediatePropagation();\n\t\t\t\t});\n\t\t},\n\t\ttemplate: treeTmpl,\n\n\t//PROPERTIES\n\t\t_newNodeCounter: 0,\n\n\t//METHODS\n\t\tselect: function(treeNode) {\n\t\t\t$.observable(this).setProperty(\"selected\", treeNode.data);\n\t\t\tif (this.onSelectionChange) {\n\t\t\t\tthis.onSelectionChange(treeNode.data);\n\t\t\t}\n\t\t},\n\t\teditedNode: function(treeNode) {\n\t\t\treturn this.editable && this.selected === treeNode;\n\t\t}\n\t},\n\n// {{treeNode}}\n\n\ttreeNodeTag = {\n\t\tinit: function(tagCtx) {\n\t\t\tthis.data = tagCtx.view.data;\n\t\t\tthis.tree = this.ctxPrm(\"tree\");\n\t\t},\n\t\ttemplate: treeNodeTmpl,\n\n\t// methods\n\t\ttoggle: function() {\n\t\t\t$.observable(this.data).setProperty(\"expanded\", !this.data.expanded);\n\t\t\tif (this.tree.onExpansionChange) {\n\t\t\t\tthis.tree.onExpansionChange(this.data);\n\t\t\t}\n\t\t},\n\t\tremove: function() {\n\t\t\tvar childNodes,\n\t\t\t\tparent = this.parent,\n\t\t\t\tcontentArray = parent.data.categories,\n\t\t\t\tindex = this.tagCtx.view.index;\n\t\t\t$.observable(contentArray).remove(index);\n\t\t\tchildNodes = parent.childTags();\n\t\t\tthis.tree.select(childNodes[index] || childNodes[index - 1] || parent);\n\t\t},\n\t\tselect: function() {\n\t\t\tif (this.tree.selected !== this.data) {\n\t\t\t\tthis.tree.select(this);\n\t\t\t}\n\t\t},\n\t\taddCategory: function() {\n\t\t\tvar childNodes,\n\t\t\t\tnodeData = this.data;\n\t\t\tnodeData.categories = nodeData.categories || [];\n\t\t\t$.observable(this.data.categories).insert({\n\t\t\t\tname: \"name\" + this.tree._newNodeCounter++,\n\t\t\t\tlabel: \"\"\n\t\t\t});\n\t\t\t$.observable(nodeData).setProperty(\"expanded\", true);\n\t\t\tchildNodes = this.childTags();\n\t\t\tthis.tree.select(childNodes[childNodes.length - 1]);\n\t\t},\n\t\tmoveCategoryUp: function() {\n\t\t\tvar index = this.tagCtx.view.index,\n\t\t\t\tcategories = this.parent.data.categories;\n\t\t\tif (index) {\n\t\t\t\t$.observable(categories).move(index, index-1);\n\t\t\t}\n\t\t},\n\t\tmoveCategoryDown: function() {\n\t\t\tvar index = this.tagCtx.view.index,\n\t\t\t\tcategories = this.parent.data.categories;\n\t\t\tif (index + 1 < categories.length) {\n\t\t\t\t$.observable(categories).move(index, index+1);\n\t\t\t}\n\t\t},\n\t\thideCategory: function() {\n\t\t\tvar category = this.parent.data.categories[this.tagCtx.view.index];\n\t\t\t$.observable(category).setProperty(\"hidden\", !category.hidden);\n\t\t}\n\t},\n\n// {{selectList}}\n// Derives from {{for}} control\n\n\tselectListTag = {\n\t\t// This tag control derives from the {{for}} tag.\n\t\tbaseTag: \"for\",\n\n\t\t// overrides of {{for}} tag.\n\n\t\tonArrayChange: function(ev, eventArgs) {\n\t\t\t// Call baseTag implementation\n\t\t\tthis.baseApply(arguments);\n\n\t\t\tif (eventArgs.change === \"insert\") {\n\t\t\t\tthis.toggleSelect(eventArgs.index);\n\t\t\t}\n\t\t},\n\t\tflow: false,\n\n\t\t// additional methods\n\n\t\ttoggleSelect: function(index) {\n\t\t\tthis.item(index).toggleSelect();\n\t\t},\n\t\titem: function(index) {\n\t\t\treturn this.childTags()[index];\n\t\t},\n\n\t\t// additional events\n\n\t\tonToggleSelect: function(child) {\n\t\t\tif (child === this.selectedChild) {\n\t\t\t\tthis.selectedChild = null;\n\t\t\t} else if (child.selected) {\n\t\t\t\tif (this.selectedChild) {\n\t\t\t\t\tthis.selectedChild.toggleSelect();\n\t\t\t\t}\n\t\t\t\tthis.selectedChild = child;\n\t\t\t}\n\t\t}\n\t};\n\n//#endregion\n\n//#region INITIALIZATION\n\ntreeTag.editedNode.depends = \"editable\";\n\n$.views.tags({\n\ttabs: tabsTag,\n\ttree: treeTag,\n\ttreeNode: treeNodeTag,\n\tselectList: selectListTag\n});\n\n//#endregion\n})(this, this.jQuery);\n"]}