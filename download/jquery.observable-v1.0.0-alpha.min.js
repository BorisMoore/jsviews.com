(function(n,t,i){"use strict";function v(n){return h(n)?new nt(n):new g(n)}function g(n){return this._data=n,this}function nt(n){return this._data=n,this}function c(n){return h(n)?[n]:n}function b(n){if(typeof n!="number")throw"Invalid index.";}function ft(n,t){n=h(n)?n:[n];for(var i,u=t,e=u,s=n.length,r=[],o=0;o<s;o++){if(i=n[o],f(i)){y.apply(r,[r.length,1].concat(ft(i.call(t,t),t)));continue}else if(""+i!==i){t=e=i,e!==u&&r.push(u=e);continue}e!==u&&r.push(u=e),r.push(i)}return r}function et(n,t){var r,i;for(r in n){i=!0;break}i||delete w[t]}function k(n,t){if(!(n.data&&n.data.off)){var r=t.oldValue,i=n.data;n.type===a?i.cb.array(n,t):(i.prop==="*"||i.prop===t.path)&&(typeof r===p&&d(c(r),i.path,i.cb),typeof(r=t.value)===p&&e(c(r),i.path,i.cb),i.cb(n,t))}}function e(){function ni(i,f,e,o){var h=ut(n),y=c(n);if(u=0,b||o)h&&(t(y).off(i,k),u&&delete u[t.data(n,"obId")]);else{if(s=h&&t._data(n))for(s=s&&s.events,s=s&&s[e?a:l],yt=s&&s.length;yt--;)if((tt=s[yt].data)&&tt.cb===r){if(e)return;f==="*"&&tt.prop!==f&&(t(n).off(i+"."+tt.prop,k),u&&delete u[t.data(n,"obId")])}t(y).on(i,null,e?{cb:r}:{path:f,prop:v,cb:r},k);kt&&(kt[t.data(n,"obId")||t.data(n,"obId",ht++)]=n)}}function fi(n,t){n._ob=it(n,lt);var i=lt;return function(){var u=n._ob,f=t.length;typeof u===p&&(gt(u,!0),f&&d(c(u),t,r,it,i)),u=n._ob=it(n,i),typeof u===p&&(gt(u),f&&e(c(u),t,r,it,i))}}function gt(t,u){if(r&&r.array&&h(t)){var f=n;n=t,ni(a+".observe.obs"+r._bnd,i,!0,u),n=f}}var vt,nt,v,o,wt,n,b,r,bt,yt,tt,s,it,ti,kt,dt,ri,ui=1,ii=rt,g=ot.apply([],arguments),st=g.pop(),lt=g[0],pt=""+lt!==lt?g.shift():i,at=g.length;for(lt=pt,f(st)?r=st:(st===!0?b=st:st&&(lt=st,ui=0),st=g[at-1],(at&&st===i||f(st))&&(r=g.pop(),at--)),f(g[at-1])&&(it=r,r=g.pop(),at--),ii+=b?r?".obs"+r._bnd:"":".obs"+(bt=r._bnd=r._bnd||ct++),b&&at===0&&pt&&t(pt).off(rt,k),b||(kt=w[bt]=w[bt]||{}),dt=0,vt=0;vt<at;vt++){if(o=g[vt],gt(n,b),n=pt,""+o===o){if(nt=o.split("^"),nt[1]&&(dt=nt[0].split(".").length,o=nt.join("."),dt=o.split(".").length-dt),it&&(ti=it(o,pt))){at+=ti.length-1,y.apply(g,[vt--,1].concat(ti));continue}nt=o.split(".")}else ui&&!f(o)&&(o._jsvOb&&(b||(o._cb=ri=fi(o,g.slice(vt+1)),o._rt=lt,ri._bnd=r._bnd),e(o._rt,g.slice(0,vt),o._cb,it,b),o=o._ob),n=o),pt=o,nt=[pt];while(n&&typeof n=="object"&&(v=nt.shift())!==i){if(""+v===v){if(v==="")continue;if(nt.length<dt+1&&!n.nodeType){if(!b&&(s=ut(n)&&t._data(n))){for(s=s.events,s=s&&s.propertyChange,yt=s&&s.length;yt--;)if(tt=s[yt].data,tt&&tt.cb===r&&(tt.prop===v&&tt.path===nt.join(".")||tt.prop==="*"))break;if(yt>-1){n=n[v];continue}}if(v==="*"){f(n)?(wt=n.depends)&&e(wt,r,b||lt):ni(ii,v);break}else!v||f(wt=n[v])&&wt.depends||ni(ii+"."+v,nt.join("."))}v=v?n[v]:n}if(f(v)){(wt=v.depends)&&e(n,ft(wt,n),r,it,b||c(lt));break}n=v}}return gt(n,b),bt&&et(kt,bt),{cbId:bt,bnd:kt,leaf:n}}function d(){return[].push.call(arguments,!0),e.apply(this,arguments)}if(!t)throw"requires jQuery or JsRender";if(!t.observable){var u,tt,o,r,it=t.event.special,s=t.views?t.views.sub:{},y=[].splice,ot=[].concat,h=t.isArray,st=t.expando,p="object",l=s.propChng=s.propChng||"propertyChange",a=s.arrChng=s.arrChng||"arrayChange",w=s._cbBnds=s._cbBnds||{},rt=l+".observe",f=t.isFunction,ht=1,ct=1,ut=t.hasData;t.observable=v,v.Object=g,v.Array=nt,v.observe=e,v.unobserve=d,g.prototype={_data:null,data:function(){return this._data},observe:function(n,t){return e(this._data,n,t)},unobserve:function(n,t){return d(this._data,n,t)},setProperty:function(n,t,r){var u,s,o,f=this,e=f._data;if(n=n||"",e)if(h(n))for(u=n.length;u--;)s=n[u],f.setProperty(s.name,s.value,r===i||r);else if(""+n!==n)for(u in n)f.setProperty(u,n[u],t);else if(n.indexOf(st)<0){for(o=n.split(".");e&&o.length>1;)e=e[o.shift()];f._setProperty(e,o.join("."),t,r)}return f},_setProperty:function(n,t,i,r){var e,o,u=t?n[t]:n;f(u)&&u.set&&(o=u,e=u.set===!0?u:u.set,u=u.call(n)),(u!==i||r&&u!=i)&&(!(u instanceof Date)||u>i||u<i)&&(e?(e.call(n,i),i=o.call(n)):n[t]=i,this._trigger(n,{path:t,value:i,oldValue:u}))},_trigger:function(n,i){t(n).triggerHandler(l,i)}},nt.prototype={_data:null,data:function(){return this._data},insert:function(n,t){return b(n),arguments.length>1&&(t=h(t)?t:[t],t.length&&this._insert(n,t)),this},_insert:function(n,t){r=this._data,o=r.length,y.apply(r,[n,0].concat(t)),this._trigger({change:"insert",index:n,items:t})},remove:function(n,t){if(b(n),t=t===i||t===null?1:t,t&&n>-1){var r=this._data.slice(n,n+t);t=r.length,t&&this._remove(n,t,r)}return this},_remove:function(n,t,i){r=this._data,o=r.length,r.splice(n,t),this._trigger({change:"remove",index:n,items:i})},move:function(n,t,r){if(b(n),b(t),r=r===i||r===null?1:r,r){var u=this._data.slice(n,n+r);this._move(n,t,r,u)}return this},_move:function(n,t,i,u){r=this._data,o=r.length,r.splice(n,i),r.splice.apply(r,[t,0].concat(u)),this._trigger({change:"move",oldIndex:n,index:t,items:u})},refresh:function(n){var t=this._data.slice(0);return this._refresh(t,n),this},_refresh:function(n,t){r=this._data,o=r.length,y.apply(r,[0,r.length].concat(t)),this._trigger({change:"refresh",oldItems:n})},_trigger:function(n){var i=r.length,u=t([r]);u.triggerHandler(a,n),i!==o&&u.triggerHandler(l,{path:"length",value:i,oldValue:o})}},it[l]=it[a]={remove:function(n){(n=n.data)&&(n.off=1,n=n.cb)&&(u=w[tt=n._bnd])},teardown:function(){u&&(delete u[t.data(this,"obId")],et(u,tt))}}}})(this,this.jQuery||this.jsviews);
//JsObservable v1.0.0-alpha: http://jsviews.com
