/*! JsViews v1.0.0-alpha: http://www.jsviews.com/#jsviews
informal pre V1.0 commit counter: 64 (Beta Candidate)*/
!function(e){"function"==typeof define&&define.amd?define(["jquery","./jsrender","./jquery.observable"],e):e(this.jQuery)}(function(e){"use strict";function t(t,n,i){var r,a,o,l,d,f,v,p,c,g,u,h,_,m,k,b,x,y=t.target,C=y._jsvBnd,w=/&(\d+)\+?/g;if(C)for(;g=w.exec(C);)if((g=Kt[g[1]])&&(k=g.to)){if(l=g.linkCtx,c=l.view,m=l.tag,p=e(y),h=c.hlp(xt),_=c.hlp(yt),o=s(y),r=Vt[o],void 0===i&&(i=dt(o)?o(y):r?p[r]():p.attr(o)),f=k[1],k=k[0],k=k+""===k?[l.data,k]:k,f&&(d=dt(f)?f:c.getRsc("converters",f)),d&&(i=d.call(m,i)),u=c.linkCtx,c.linkCtx=l,b={change:"change",oldValue:l._val,value:i},!(h&&(a=h.call(l,t,b)===!1)||m&&m.onBeforeChange&&(a=m.onBeforeChange(t,b)===!1)||void 0===i)&&(v=k[0],void 0!==i&&v)){if(v._jsv)for(x=v,v=l.data;x&&x.sb;)v=l._ctxCb(x,v),x=x.sb;m&&(m._.chging=!0),$(v).setProperty(k[2]||k[1],i),_&&_.call(l,t,b),m&&(m.onAfterChange&&m.onAfterChange(t,b),m._.chging=void 0),l._val=i}c.linkCtx=u}}function n(e,t,n){var r,o,l,d,f,p,c=this,g=c.tag,u=c.data,h=c.elem,_=c.convert,m=h.parentNode,k=c.view,b=k.linkCtx,x=k.hlp(xt);if(k.linkCtx=c,!(!m||x&&t&&x.call(c,e,t)===!1||t&&"*"!==e.data.prop&&e.data.prop!==t.path)){if(t&&(c.eventArgs=t),t||c._toLk){if(c._toLk=0,n._er)try{o=n(u,k)}catch(y){f=n._er,p=J(y,k,new Function("data,view","return "+f+";")(u,k)),o=[{props:{},args:[p]}]}else o=n(u,k,O);if(r=i(o,c,g=c.tag,c.attr||s(h,!0,void 0!==_)),g){if(d=f||g._er,o=o[0]?o:[o],l=!d&&t&&g.onUpdate&&g.onUpdate(e,t,o)===!1,E(g,o,d),l||r===Et)return r===ut&&g.onBeforeLink&&g.onBeforeLink(),C(g),v(c,u,h),void(k.linkCtx=b);if(g._.chging)return;o=":"===g.tagName?O._cnvt(g.cvt,k,o[0]):O._tag(g,k,k.tmpl,o,!0,p)}else n._tag&&(_=""===_?Lt:_,o=_?O._cnvt(_,k,o[0]||o):O._tag(n._tag,k,k.tmpl,o,!0,p),g=c.tag,r=c.attr||r);a(o,c,r,g)&&t&&(x=k.hlp(yt))&&x.call(c,e,t),c._noUpd=0,g&&(g._er=f,C(g,t))}v(c,u,h),k.linkCtx=b}}function i(t,n,i,r){var a,o,l,s,d=i&&i.parentElem||n.elem;if(void 0!==t){if(s=e(d),r=i&&i.attr||r,dt(t)&&J(n.expr+": missing parens"),l=/^css-/.test(r)&&r.slice(4))a=e.style(d,l),+t===t&&(a=parseInt(a));else if("link"!==r){if("value"===r)d.type===jt&&(a=s.prop(r=wt));else if(r===At){if(d.value!==""+t)return r;a=s.prop(wt)}void 0===a&&(o=Vt[r],a=o?s[o]():s.attr(r))}n._val=a}return r}function r(e,t){e._df=t,e[(t?"set":"remove")+"Attribute"](Tt,"")}function a(t,n,i,a){var o,l,s,d,f,p,c,g,u,h,_,m,k,b=void 0!==t&&!n._noUpd,x=n.data,y=a&&a.parentElem||n.elem,C=e(y),w=n.view,j=n._val,A=w.linkCtx,E=a||i===ut;if(a&&(a.parentElem=a.parentElem||n.expr||a._elCnt?y:y.parentNode,l=a._prv,s=a._nxt),!b)return void(i===ut&&a&&a.onBeforeLink&&a.onBeforeLink());if("visible"===i&&(i="css-display"),/^css-/.test(i))"visible"===n.attr&&(k=(y.currentStyle||en.call(rt,y,"")).display,t?(t=y._jsvd||k,t!==Et||(t=zt[m=y.nodeName])||(_=at.createElement(m),at.body.appendChild(_),t=zt[m]=(_.currentStyle||en.call(rt,_,"")).display,at.body.removeChild(_))):(y._jsvd=k,t=Et)),(E=E||j!==t)&&e.style(y,i.slice(4),t);else if(/^data-/.test(i))e.data(y,i.slice(5),t);else if("link"!==i){if(i===wt)p=!0,t=t&&"false"!==t;else if(i===At){if(y.value!==""+t)return void v(n,x,y);t=p=!0,i=wt}else("selected"===i||"disabled"===i||"multiple"===i||"readonly"===i)&&(t=t&&"false"!==t?i:null);(o=Vt[i])?i===ut?(w.linkCtx=n,a&&a._.inline?(f=a.nodes(!0),a._elCnt&&(l&&l!==s?V(l,s,y,a._tgId,"^",!0):(c=y._df)&&(g=a._tgId+"^",u=c.indexOf("#"+g)+1,h=c.indexOf("/"+g),u&&h>0&&(u+=g.length,h>u&&(r(y,c.slice(0,u)+c.slice(h)),M(c.slice(u,h))))),l=l?l.previousSibling:s?s.previousSibling:y.lastChild),e(f).remove(),a&&a.onBeforeLink&&a.onBeforeLink(),d=w.link(w.data,y,l,s,t,a&&{tag:a._tgId,lazyLink:a.tagCtx.props.lazyLink})):(b&&C.empty(),a&&a.onBeforeLink&&a.onBeforeLink(),b&&(d=w.link(x,y,l,s,t,a&&{tag:a._tgId}))),w.linkCtx=A):(E=E||j!==t)&&("text"===i&&y.children&&!y.children[0]?void 0!==y.textContent?y.textContent=t:y.innerText=null===t?"":t:C[o](t)):(E=E||j!==t)&&C[p?"prop":"attr"](i,void 0!==t||p?t:null),n._val=t}return d||E}function o(e,t){var n=this,i=n.hlp(xt),r=n.hlp(yt);if(!i||i.call(this,e,t)!==!1){if(t){var a=t.change,o=t.index,l=t.items;switch(a){case"insert":n.addViews(o,l);break;case"remove":n.removeViews(o,l.length);break;case"move":n.refresh();break;case"refresh":n.refresh()}}r&&r.call(this,e,t)}}function l(t){var n,i,r=t.type,a=t.data,l=t._.bnd;!t._.useKey&&l&&((i=t._.bndArr)&&(e([i[1]]).off(gt,i[0]),t._.bndArr=void 0),l!==!!l?r?l._.arrVws[t._.id]=t:delete l._.arrVws[t._.id]:r&&a&&(n=function(e){e.data&&e.data.off||o.apply(t,arguments)},e([a]).on(gt,n),t._.bndArr=[n,a]))}function s(e,t,n){var i=e.nodeName.toLowerCase(),r=lt.merge[i]||e.contentEditable===Lt&&{to:ut,from:ut};return r?t?"input"===i&&e.type===At?At:r.to:r.from:t?n?"text":ut:""}function d(t,n,i,r,a,o,l){var s,d,f,v,p,c=t.parentElem,g=t._prv,u=t._nxt,h=t._elCnt;if(g&&g.parentNode!==c&&J("Missing parentNode"),l){v=t.nodes(),h&&g&&g!==u&&V(g,u,c,t._.id,"_",!0),t.removeViews(void 0,void 0,!0),d=u,h&&(g=g?g.previousSibling:u?u.previousSibling:c.lastChild),e(v).remove();for(p in t._.bnds)L(p)}else{if(n){if(f=r[n-1],!f)return!1;g=f._nxt}h?(d=g,g=d?d.previousSibling:c.lastChild):d=g.nextSibling}s=i.render(a,o,t._.useKey&&l,t,l||n,!0),t.link(a,c,g,d,s,f)}function f(e,t,n){var i,r,a;return n?(a="^`",r=t._.tag,i=r._tgId,i||(Kt[i=Ht++]=r,r._tgId=""+i)):(a="_`",nt[i=t._.id]=t),"#"+i+a+(void 0!=e?e:"")+"/"+i+a}function v(e,t,n){var i,r,a,o,l,s=e.tag,d=e.convertBack,f=[],v=e._bndId||""+Ht++,p=e._hdl;if(e._bndId=void 0,s&&(f=s.depends||f,f=dt(f)?s.depends(s):f,a=s.linkedElem),!e._depends||""+e._depends!=""+f){for(e._depends&&$._apply(!1,[t],e._depends,p,!0),o=e.fn.deps.slice(),r=o.length;r--;)l=o[r],l._jsv&&(o[r]=st({},l));i=$._apply(!1,[t],o,f,p,e._ctxCb),i.elem=n,i.linkCtx=e,i._tgId=v,n._jsvBnd=n._jsvBnd||"",n._jsvBnd+="&"+v,e._depends=f,e.view._.bnds[v]=v,Kt[v]=i,a&&(i.to=[[],d]),(a||void 0!==d)&&A(i,s&&s.convertBack||d),s&&(s.onAfterBind&&s.onAfterBind(i),s.flow||s._.inline||(n.setAttribute(kt,(n.getAttribute(kt)||"")+"#"+v+"^/"+v+"^"),s._tgId=""+v))}if(a&&a[0])for(s._.radio&&(a=a.children("input[type=radio]")),r=a.length;r--;)a[r]._jsvBnd=a[r]._jsvBnd||n._jsvBnd+"+",a[r]._jsvLkEl=s}function p(e,t,n,i,r,a,o){return c(this,e,t,n,i,r,a,o)}function c(n,i,a,o,l,s,d,v){if(o===!0?(l=o,o=void 0):"object"!=typeof o&&(o=void 0),n&&i){i=i.jquery?i:e(i),W||(W=at.body,e(W).on(bt,t).on("blur","[contenteditable]",t));for(var p,c,g,h,_,m,b,x,y,C=f,w=o&&"replace"===o.target,j=i.length;j--;){if(b=i[j],s=s||G(b),(y=s===Q)&&(Q.data=(Q.ctx=o||{}).root=a),""+n===n)u(n,b,s,void 0,!0,a,o);else{if(void 0!==n.markup)s.link===!1&&(o=o||{},o.link=C=!1),w&&(m=b.parentNode),g=n.render(a,o,l,s,void 0,C),m?(d=b.previousSibling,v=b.nextSibling,e.cleanData([b],!0),m.removeChild(b),b=m):(d=v=void 0,e(b).empty());else{if(n!==!0||s!==Q)break;x={lnk:1}}if(b._df&&!v){for(h=k(b._df,!0,Wt),p=0,c=h.length;c>p;p++)_=h[p],(_=nt[_.id])&&void 0!==_.data&&_.parent.removeViews(_._.key,void 0,!0);r(b)}s.link(a,b,d,v,g,x,o)}y&&(Q.data=Q.ctx=void 0)}}return i}function g(t,n,i,a,s,d,v,p){function c(e,t,n,i,r,a,o,l,d,f,v,p,c,g){var u,h,_="";return g?(w=0,e):(A=d||f||"",i=i||v,n=n||c,ot&&!n&&(!e||i||A||a&&!w)&&(ot=void 0,rt=It.shift()),i=i||n,i&&(w=0,ot=void 0,K&&(n||c?Ft[rt]||/;svg;|;math;/.test(";"+It.join(";")+";")||(u="'<"+rt+".../"):Ft[i]?u="'</"+i:It.length&&i===rt||(u="Mismatch: '</"+i),u&&ht(u+">' in:\n"+s)),pt=vt,rt=It.shift(),vt=$t[rt],v=v?"</"+v+">":"",pt&&(Et+=gt,gt="",vt?Et+="-":(_=v+St+"@"+Et+Nt+(p||""),Et=Vt.shift()))),vt?(a?gt+=a:t=v||c||"",A&&(t+=A,gt&&(t+=" "+kt+'="'+gt+'"',gt=""))):t=a?t+_+r+(w?"":St+a+Nt)+l+A:_||e,K&&o&&(w&&ht("{^{ within elem markup ("+w+' ). Use data-link="..."'),"#"===a.charAt(0)?It.unshift(a.slice(1)):a.slice(1)!==(h=It.shift())&&ht("Closing tag for {^{...}} under different elem: <"+h+">")),A&&(w=A,It.unshift(rt),rt=A.slice(1),It[0]&&It[0]===Rt[rt]&&J("Parent of <tr> must be <tbody>"),ot=Ft[rt],(vt=$t[rt])&&!pt&&(Vt.unshift(Et),Et=""),pt=vt,Et&&vt&&(Et+="+")),t)}function g(e,t){var i,a,s,d,v,p,c,g=[];if(e){for("@"===e._tkns.charAt(0)&&(t=T.previousSibling,T.parentNode.removeChild(T),T=void 0),N=e.length;N--;){if(V=e[N],s=V.ch,i=V.path)for(L=i.length-1;a=i.charAt(L--);)"+"===a?"-"===i.charAt(L)?(L--,t=t.previousSibling):t=t.parentNode:t=t.lastChild;"^"===s?(A=Kt[v=V.id])&&(c=t&&(!T||T.parentNode!==t),(!T||c)&&(A.parentElem=t),V.elCnt&&c&&r(t,(V.open?"#":"/")+v+s+(t._df||"")),g.push([c?null:T,V])):(I=nt[v=V.id])&&(I.parentElem||(I.parentElem=t||T&&T.parentNode||n,I._.onRender=f,I._.onArrayChange=o,l(I)),d=I.parentElem,V.open?(I._elCnt=V.elCnt,t&&!T?r(t,"#"+v+s+(t._df||"")):(I._prv||r(d,_(d._df,"#"+v+s)),I._prv=T)):(!t||T&&T.parentNode===t?T&&(I._nxt||r(d,_(d._df,"/"+v+s)),I._nxt=T):(r(t,"/"+v+s+(t._df||"")),I._nxt=void 0),j=I.linkCtx,(p=I.ctx&&I.ctx.onAfterCreate||Mt)&&p.call(j,I)))}for(N=g.length;N--;)Bt.push(g[N])}return!e||e.elCnt}function h(e){var t,n,i;if(e)for(N=e.length,L=0;N>L;L++)if(V=e[L],n=A=Kt[V.id].linkCtx.tag,i=A.tagName===F,!A.flow||i){if(!R){for(t=1;n=n.parent;)t++;H=H||t}!R&&t!==H||F&&!i||$.push(A)}}function y(){var r,o,l="",d={},f=et+(wt?",["+Tt+"]":"");for(S=Ot?n.querySelectorAll(f):e(f,n).get(),B=S.length,i&&i.innerHTML&&(D=Ot?i.querySelectorAll(f):e(f,i).get(),i=D.length?D[D.length-1]:i),H=0,E=0;B>E;E++)if(T=S[E],i&&!mt)mt=T===i;else{if(a&&T===a){wt&&(l+=m(T));break}if(T.parentNode)if(wt){if(l+=m(T),T._df){for(r=E+1;B>r&&T.contains(S[r]);)r++;d[r-1]=T._df}d[E]&&(l+=d[E]||"")}else yt&&(V=k(T,void 0,Gt))&&(V=V[0])&&(bt=bt?V.id!==bt&&bt:V.open&&V.id),!bt&&Dt(k(T))&&T.getAttribute(Y)&&Bt.push([T])}if(wt&&(l+=n._df||"",(o=l.indexOf("#"+wt.id)+1)&&(l=l.slice(o+wt.id.length)),o=l.indexOf("/"+wt.id),o+1&&(l=l.slice(0,o)),h(k(l,void 0,Yt))),void 0===s&&n.getAttribute(Y)&&Bt.push([n]),b(i,vt),b(a,vt),wt)return void(xt&&xt.resolve());for(vt&&Et+gt&&(T=a,Et&&(a?g(k(Et+"+",!0),a):g(k(Et,!0),n)),g(k(gt,!0),n),a&&(l=a.getAttribute(kt),(B=l.indexOf(ut)+1)&&(l=l.slice(B+ut.length-1)),a.setAttribute(kt,gt+l))),B=Bt.length,E=0;B>E;E++)T=Bt[E],M=T[1],T=T[0],M?(A=Kt[M.id])&&((j=A.linkCtx)&&(A=j.tag,A.linkCtx=j),M.open?(T&&(A.parentElem=T.parentNode,A._prv=T),A._elCnt=M.elCnt,A.onBeforeLink&&A.onBeforeLink(),I=A.tagCtx.view,u(void 0,A._prv,I,M.id)):(A._nxt=T,A._.unlinked&&(z=A.tagCtx,I=z.view,C(A)))):u(T.getAttribute(Y),T,G(T),void 0,yt,t,v);xt&&xt.resolve()}var w,j,A,E,B,L,N,S,T,I,V,M,D,P,q,U,O,$,R,F,z,K,H,Q,W,X,Z,rt,ot,st,dt,ft,vt,pt,ct,gt,ut,mt,bt,xt,yt,wt,jt=this,At=jt._.id+"_",Et="",Bt=[],It=[],Vt=[],Mt=jt.hlp(Ct),Dt=g;if(d&&(xt=d.lazyLink&&e.Deferred(),d.tmpl?q="/"+d._.id+"_":(yt=d.lnk,d.tag&&(At=d.tag+"^",d=!0),(wt=d.get)&&(Dt=h,$=wt.tags,R=wt.deep,F=wt.name)),d=d===!0),n=n?""+n===n?e(n)[0]:n.jquery?n[0]:n:jt.parentElem||at.body,K=!lt.noValidate&&n.contentEditable!==Lt,rt=n.tagName.toLowerCase(),vt=!!$t[rt],i=i&&x(i,vt),a=a&&x(a,vt)||null,void 0!=s){if(dt=at.createElement("div"),st=dt,ut=gt="",ct="http://www.w3.org/2000/svg"===n.namespaceURI?"svg_ns":(Z=_t.exec(s))&&Z[1]||"",it&&Z&&Z[2]&&J("Unsupported: "+Z[2]),vt){for(O=a;O&&!(U=k(O));)O=O.nextSibling;(ft=U?U._tkns:n._df)&&(P=q||"",(d||!q)&&(P+="#"+At),L=ft.indexOf(P),L+1&&(L+=P.length,ut=gt=ft.slice(0,L),ft=ft.slice(L),U?O.setAttribute(kt,ft):r(n,ft)))}if(ot=void 0,s=(""+s).replace(Qt,c),K&&It.length&&ht("Mismatched '<"+rt+"...>' in:\n"+s),p)return;for(Ut.appendChild(dt),ct=tt[ct]||tt.div,Q=ct[0],st.innerHTML=ct[1]+s+ct[2];Q--;)st=st.lastChild;for(Ut.removeChild(dt),W=at.createDocumentFragment();X=st.firstChild;)W.appendChild(X);n.insertBefore(W,a)}return xt?setTimeout(y,0):y(),xt&&xt.promise()}function u(e,t,n,i,r,a,o){var l,d,f,v,p,c,g,u,_,m,k,b,x=[];if(i)m=Kt[i],m=m.linkCtx?m.linkCtx.tag:m,_=m.linkCtx||{data:n.data,elem:m._elCnt?m.parentElem:t,view:n,ctx:n.ctx,attr:ut,fn:m._.bnd,tag:m,_bndId:i},h(_,_.fn);else if(e&&t){for(a=r?a:n.data,l=n.tmpl,e=y(e,s(t)),X.lastIndex=0;d=X.exec(e);)x.push(d);for(;d=x.shift();){for(k=X.lastIndex,f=d[1],g=d[3];x[0]&&"else"===x[0][4];)g+="}{"+x.shift()[3],b=!0;b&&(g+="}{{/"+d[4]+"}"),p=d[10],v=void 0,_={data:a,elem:t,view:n,ctx:o,attr:f,isLk:r,_toLk:1,_noUpd:d[2]},d[6]&&(!f&&(v=/:([\w$]*)$/.exec(p))&&(v=v[1],void 0!==v&&(c=-v.length-1,g=g.slice(0,c-1)+z)),null===v&&(v=void 0),_.convert=d[5]||""),_.expr=f+g,u=l.links[g],u||(l.links[g]=u=ot.tmplFn(g,l,!0,v,b)),_.fn=u,f||void 0===v||(_.convertBack=v),h(_,u),X.lastIndex=k}}}function h(e,t){function i(i,r){n.call(e,i,r,t)}i.noArray=!0,e.isLk&&(e.view=new ot.View(e.ctx,"link",Q,e.data,Q.tmpl,void 0,void 0,f)),e._ctxCb=T(e.view),e._hdl=i,i(!0)}function _(e,t){var n;return e?(n=e.indexOf(t),n+1?e.slice(0,n)+e.slice(n+t.length):e):""}function m(e){return e&&(""+e===e?e:e.tagName===Bt?e.type.slice(3):1===e.nodeType&&e.getAttribute(kt)||"")}function k(e,t,n){function i(e,t,n,i,a,l){o.push({elCnt:r,id:i,ch:a,open:t,close:n,path:l,token:e})}var r,a,o=[];return(a=t?e:m(e))?(r=o.elCnt=e.tagName!==Bt,r="@"===a.charAt(0)||r,o._tkns=a,a.replace(n||Zt,i),o):void 0}function b(e,t){e&&("jsv"===e.type?e.parentNode.removeChild(e):t&&""===e.getAttribute(Y)&&e.removeAttribute(Y))}function x(e,t){for(var n=e;t&&n&&1!==n.nodeType;)n=n.previousSibling;return n&&(1!==n.nodeType?(n=at.createElement(Bt),n.type="jsv",e.parentNode.insertBefore(n,e)):m(n)||n.getAttribute(Y)||n.setAttribute(Y,"")),n}function y(t,n){return t=e.trim(t).replace(mt,"\\$&"),t.slice(-1)!==z?t=F+":"+t+(n?":":"")+z:t}function C(t,n){var i,r,a,o,l,s,d,f,v=t.tagCtx,p=v.view,c=v.props,g=t.linkCtx=t.linkCtx||{tag:t,data:p.data,view:p,ctx:p.ctx};if(t.onAfterLink&&t.onAfterLink(v,g,n),t._.unlinked=void 0,i=t.targetTag?t.targetTag.linkedElem:t.linkedElem,!t.noVal&&(r=i&&i[0])){if((a=t._.radio)&&(i=i.children("input[type=radio]")),a||!t._.chging){if(o=t.cvtArgs()[0],a||r!==g.elem){for(l=i.length;l--;)r=i[l],s=r._jsvLkEl,t._.inline&&(!s||s!==t&&s.targetTag!==t)&&(r._jsvLkEl=t,A(Kt[t._tgId],t.convertBack),r._jsvBnd="&"+t._tgId+"+"),a&&(r[wt]=o===r.value);g._val=o}void 0!==o&&(a||void 0===r.value?r.contentEditable===Lt&&(r.innerHTML=o):r.type===jt?r[wt]=o&&"false"!==o:i.val(o))}t.setSize&&(c.height&&i.height(c.height),c.width&&i.width(c.width)),c["class"]&&i.addClass(c["class"]),c.id&&(i[0].id=c.id),c.name&&i.attr("name",c.name)}(r=r||":"===t.tagName&&g.elem)&&(d=r._jsvTr,f=c.trigger,d!==f&&(r._jsvTr=f,i=i||e(r),j(i,d,"off"),j(i,f,"on")))}function w(e){setTimeout(function(){t(e)},0)}function j(e,n,i){n&&e[i](n===!0?"keydown":n,n===!0?w:t)}function A(e,t){var n,i,r,a,o,l=e.linkCtx,s=l.data,d=l.fn.paths;if(e&&d)if(d=(n=d._jsvto)||d[0],i=d&&d.length,!i||l.tag&&!l.tag.tagCtx.args.length)e.to=[[],t];else{if(a=d[i-1],a._jsv){for(o=a;a.sb&&a.sb._jsv;)r=a=a.sb;r=a.sb||r&&r.path,a=r?r.slice(1):o.path}e.to=r?[[o,a],t]:[l._ctxCb(r=a.split("^").join("."))||[s,r],t]}}function E(e,t,n){var i,r,a=e.tagCtx.view,o=e.tagCtxs||[e.tagCtx],l=o.length,s=!t;if(t=t||e._.bnd.call(a.tmpl,(e.linkCtx||a).data,a,O),n)o=e.tagCtxs=t,e.tagCtx=o[0];else for(;l--;)i=o[l],r=t[l],$(i.props).setProperty(r.props),st(i.ctx,r.ctx),i.args=r.args,s&&(i.tmpl=r.tmpl);return ot._ths(e,o[0]),o}function B(e){for(var t,n,i,r=[],a=e.length,o=a;o--;)r.push(e[o]);for(o=a;o--;)if(n=r[o],n.parentNode){if(i=n._jsvBnd)for(i=i.slice(1).split("&"),n._jsvBnd="",t=i.length;t--;)L(i[t],n._jsvLkEl,n);M(m(n)+(n._df||""))}}function L(t,n,i){var r,a,o,l,s,d,f,v,p,c,g,u=Kt[t];if(n)i===n.linkedElem[0]&&(i._jsvLkEl=void 0,n.linkedElem=void 0);else if(u){delete Kt[t];for(r in u.bnd)l=u.bnd[r],s=u.cbId,e.isArray(l)?e([l]).off(gt+s).off(ct+s):e(l).off(ct+s),delete u.bnd[r];if(a=u.linkCtx){if(o=a.tag){if(d=o.tagCtxs)for(f=d.length;f--;)(v=d[f].map)&&v.unmap();p=o.linkedElem,c=p&&p[0]||a.elem,(g=c&&c._jsvTr)&&(j(p||e(c),g,"off"),c._jsvTr=void 0),o.onDispose&&o.onDispose(),o._elCnt||(o._prv&&o._prv.parentNode.removeChild(o._prv),o._nxt&&o._nxt.parentNode.removeChild(o._nxt))}delete a.view._.bnds[t]}ot._cbBnds[u.cbId]=void 0}}function N(n,i){return void 0===n?(W&&(e(W).off(bt,t).off("blur","[contenteditable]",t),W=void 0),n=!0,Q.removeViews(),B(at.body.getElementsByTagName("*"))):i&&n===!0&&(i=i.jquery?i:e(i),i.each(function(){for(var e;(e=G(this,!0))&&e.parent;)e.parent.removeViews(e._.key,void 0,!0);B(this.getElementsByTagName("*")),B([this])})),i}function S(e,t){return N(this,e,t)}function T(e){return function(t,n){var i,r,a=[n];if(e&&t){if(t._jsv)return t._jsv.call(e.tmpl,n,e,O);if("~"===t.charAt(0))return"~tag"===t.slice(0,4)&&(r=e.ctx,"."===t.charAt(4)&&(i=t.slice(5).split("."),r=r.tag),i)?r?[r,i.join("."),n]:[]:(t=t.slice(1).split("."),(n=e.hlp(t.shift()))&&(t.length&&a.unshift(t.join(".")),a.unshift(n)),n?a:[]);if("#"===t.charAt(0))return"#data"===t?[]:[e,t.replace(Jt,""),n]}}}function I(e){return e.type===jt?e[wt]:e.value}function V(e,t,n,i,a,o){var l,s,d,f,v,p,c,g=0,u=e===t;if(e){for(d=k(e)||[],l=0,s=d.length;s>l;l++){if(f=d[l],p=f.id,p===i&&f.ch===a){if(!o)break;s=0}u||(v="_"===f.ch?nt[p]:Kt[p].linkCtx.tag,f.open?v._prv=t:f.close&&(v._nxt=t)),g+=p.length+2}g&&e.setAttribute(kt,e.getAttribute(kt).slice(g)),c=t?t.getAttribute(kt):n._df,(s=c.indexOf("/"+i+a)+1)&&(c=d._tkns.slice(0,g)+c.slice(s+(o?-1:i.length+1))),c&&(t?t.setAttribute(kt,c):r(n,c))}else r(n,_(n._df,"#"+i+a)),o||t||r(n,_(n._df,"/"+i+a))}function M(e){var t,n,i,r;if(r=k(e,!0,Xt))for(t=0,n=r.length;n>t;t++)i=r[t],"_"===i.ch?(i=nt[i.id])&&i.type&&i.parent.removeViews(i._.key,void 0,!0):L(i.id)}function D(e,t,n){if("set"===n.change){for(var i=e.tgt,r=i.length;r--&&i[r].key!==n.path;);-1===r?n.path&&!n.remove&&$(i).insert({key:n.path,prop:n.value}):n.remove?$(i).remove(r):$(i[r]).setProperty("prop",n.value)}}function P(e,t,n){var i,r=e.src,a=n.change;"set"===a?"prop"===n.path?$(r).setProperty(t.target.key,n.value):($(r).setProperty(n.oldValue,null),delete r[n.oldValue],$(r).setProperty(n.value,t.target.prop)):"remove"===a?(i=n.items[0],$(r).removeProperty(i.key),delete r[i.key]):"insert"===a&&(i=n.items[0],i.key&&$(r).setProperty(i.key,i.prop))}function q(e){return e.indexOf(".")<0}var U="JsViews requires ";if(!e)throw U+"jQuery";var O=e.views,$=e.observable;if(!O||!O.settings)throw U+"JsRender";if(!$)throw U+"JsObservable";var R,F,z,K,H,J,Q,W,X,G,Y,Z,et,tt,nt,it,rt=(0,eval)("this"),at=rt.document,ot=O.sub,lt=O.settings,st=ot.extend,dt=e.isFunction,ft=O.converters,vt=O.tags,pt=$.observe,ct=ot.propChng=ot.propChng||"propertyChange",gt=ot.arrChng=ot.arrChng||"arrayChange",ut="html",ht=ot.syntaxErr,_t=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,mt=/['"\\]/g,kt="data-jsv",bt="change.jsv",xt="onBeforeChange",yt="onAfterChange",Ct="onAfterCreate",wt="checked",jt="checkbox",At="radio",Et="none",Bt="SCRIPT",Lt="true",Nt='"></script>',St='<script type="jsv',Tt=kt+"-df",It="script,["+kt+"]",Vt={value:"val",input:"val",html:ut,text:"text"},Mt={from:"value",to:"value"},Dt=0,Pt=e.cleanData,qt=lt.delimiters,Ut=at.createDocumentFragment(),Ot=at.querySelector,$t={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},Rt={tr:"table"},Ft={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},zt={},Kt={},Ht=1,Jt=/^#(view\.?)?/,Qt=/(^|(\/>)|<\/(\w+)>|)(\s*)([#\/]\d+(?:_|(\^)))`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>))/g,Wt=/(#)()(\d+)(_)/g,Xt=/(#)()(\d+)([_^])/g,Gt=/(?:(#)|(\/))(\d+)(_)/g,Yt=/(#)()(\d+)(\^)/g,Zt=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,en=rt.getComputedStyle;return e.link?e:(Z={contents:function(t,n){t!==!!t&&(n=t,t=void 0);var i,r=e(this.nodes());return r[0]&&(i=n?r.filter(n):r,r=t&&n?i.add(r.find(n)):i),r},nodes:function(e,t,n){var i,r=this,a=r._elCnt,o=!t&&a,l=[];for(t=t||r._prv,n=n||r._nxt,i=o?t===r._nxt?r.parentElem.lastSibling:t:r._.inline===!1?t||r.linkCtx.elem.firstChild:t&&t.nextSibling;i&&(!n||i!==n);)(e||a||i.tagName!==Bt)&&l.push(i),i=i.nextSibling;return l},childTags:function(e,t){e!==!!e&&(t=e,e=void 0);var n=this,i=n.link?n:n.tagCtx.view,r=n._prv,a=n._elCnt,o=[];return i.link(void 0,n.parentElem,a?r&&r.previousSibling:r,n._nxt,void 0,{get:{tags:o,deep:e,name:t,id:n.link?n._.id+"_":n._tgId+"^"}}),o},refresh:function(e){var t,n,i=this,r=i.linkCtx,o=i.tagCtx.view;return i.disposed&&J("Removed tag"),void 0===e&&(e=O._tag(i,o,o.tmpl,E(i),!0)),e+""===e&&(n=i._.inline?ut:r.attr||s(i.parentElem,!0),t=a(e,r,n,i)),C(i),t||i},update:function(e){var n=this.linkedElem;n&&t({target:n[0]},void 0,e)}},ot.onStore.template=function(t,n){n.link=p,n.unlink=S,t&&(e.link[t]=function(){return p.apply(n,arguments)},e.unlink[t]=function(){return S.apply(n,arguments)})},st(st(ot._tg.prototype,Z),{domChange:function(){var t=this.parentElem,n=e.hasData(t)&&e._data(t).events,i="jsv-domchange";n&&n[i]&&e(t).triggerHandler(i,arguments)}}),ot.viewInfos=k,(lt.delimiters=function(){var e=qt.apply(0,arguments);return R=e[0],F=e[1],z=e[2],K=e[3],H=e[4],X=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+H+")?(\\"+F+ot.rTag+"\\"+z+")","g"),this})(),st(st(ot.View.prototype,Z),{addViews:function(e,t,n){var i,r,a=this,o=t.length,l=a.views;if(!a._.useKey&&o&&(n=a.tmpl)&&(r=l.length+o,r===a.data.length&&d(a,e,n,l,t,a.ctx)!==!1))for(i=e+o;r>i;i++)$(l[i]).setProperty("index",i);return a},removeViews:function(t,n,i){function r(t){var n,r,a,o,s,d,f=v[t];if(f&&f.link){if(n=f._.id,i||(d=f.nodes()),f.removeViews(void 0,void 0,!0),f.type=void 0,o=f._prv,s=f._nxt,a=f.parentElem,i||(f._elCnt&&V(o,s,a,n,"_"),e(d).remove()),!f._elCnt)try{o.parentNode.removeChild(o),s.parentNode.removeChild(s)}catch(p){}l(f);for(r in f._.bnds)L(r);delete nt[n]}}var a,o,s,d=this,f=!d._.useKey,v=d.views;if(f&&(s=v.length),void 0===t)if(f){for(a=s;a--;)r(a);d.views=[]}else{for(o in v)r(o);d.views={}}else if(void 0===n&&(f?n=1:(r(t),delete v[t])),f&&n&&s-n===d.data.length){for(a=t+n;a-->t;)r(a);if(v.splice(t,n),s=v.length)for(;s>t;)$(v[t]).setProperty("index",t++)}return this},refresh:function(e){var t=this,n=t.parent;return n&&(d(t,t.index,t.tmpl,n.views,t.data,e,!0),l(t)),t},link:g}),ft.merge=function(e){var t,n=this.linkCtx._val||"",i=this.tagCtx.props.toggle;return i&&(t=i.replace(/[\\^$.|?*+()[{]/g,"\\$&"),t="(\\s(?="+t+"$)|(\\s)|^)("+t+"(\\s|$))",n=n.replace(new RegExp(t),"$2"),e=n+(e?(n&&" ")+i:"")),e},vt("on",{attr:Et,init:function(e){var t=this,n=e.props,i=e.content,r=n.elem;t._.inline&&(t.attr=ut,r=(r||"span")+">",t.template="<"+r+(n.label||i.markup||e.params.args[0])+"</"+r)},render:function(){var e=this.tagCtx;return e.render(e.view,!0)},onAfterLink:function(t,n){var i,r,a=this,o=0,l=t.args,s=l.length,d=t.props,f=d.data,v=t.view,p=d.context;for(a.activeElem=a.activeElem||e(a._.inline?(a._elCnt&&J('Use data-link="{on...}"'),a.nodes()[0]):n.elem);s>o&&!(r=dt(i=l[o++])););r&&(r=l.slice(o),l=l.slice(0,o-1),p||(p=/^(.*)[\.^][\w$]+$/.exec(t.params.args.slice(-r.length-1)[0]),p=p&&ot.tmplFn("{:"+p[1]+"}",v.tmpl,!0)(n.data,v)),a._evs&&a.onDispose(),a.activeElem.on(a._evs=l[0]||"click",a._sel=l[1],void 0==f?null:f,a._hlr=function(e){return i.apply(p||n.data,[].concat(r,e,{change:e.type,view:v,linkCtx:n},r.slice.call(arguments,1)))}))},onUpdate:function(){return!1},onDispose:function(){this.activeElem.off(this._evs,this._sel,this._hlr)},flow:!0}),st(vt["for"],{onArrayChange:function(e,t,n,i){var r,a=e.target,o=a.length,l=this,s=t.change;if(l._.noVws||l.tagCtxs[1]&&("insert"===s&&o===t.items.length||"remove"===s&&!o||"refresh"===s&&!t.oldItems.length!=!o))l.refresh();else for(r in l._.arrVws)r=l._.arrVws[r],r.data===a&&r._.onArrayChange.apply(r,arguments);l.domChange(n,i,t),e.done=!0},onAfterLink:function(t,n){var i,r,a,o,l=this,s=l._ars||{},d=l.tagCtxs,f=d.length,v=l.selected||0;for(i=0;v>=i;i++)t=d[i],o=t.map?t.map.tgt:t.args.length?t.args[0]:t.view.data,(a=s[i])&&o!==a[0]&&(pt(a[0],a[1],!0),delete s[i]),!s[i]&&e.isArray(o)&&(pt(o,r=function(e,i){var r=t;l.onArrayChange(e,i,r,n)}),s[i]=[o,r]);for(i=v+1;f>i;i++)(a=s[i])&&(pt(a[0],a[1],!0),delete s[i]);l._ars=s},onDispose:function(){var e,t=this;for(e in t._ars)pt(t._ars[e][0],t._ars[e][1],!0)}}),st(vt["for"],Z),st(vt["if"],Z),st(vt.include,Z),st(vt["if"],{onUpdate:function(e,t,n){var i,r,a;for(i=0;(r=this.tagCtxs[i])&&r.args.length;i++)if(r=r.args[0],a=!r!=!n[i].args[0],!this.convert&&r||a)return a;return!1},onAfterLink:function(e,t,n){n&&this.domChange(e,t,n)}}),vt("props",{baseTag:"for",dataMap:O.map({getTgt:vt.props.dataMap.getTgt,obsSrc:D,obsTgt:P,tgtFlt:q}),flow:!0}),st(e,{view:O.view=G=function(t,n,i){function r(e,t){if(e)for(o=k(e,t,Wt),s=0,d=o.length;d>s&&(!(a=nt[o[s].id])||!(a=a&&i?a.get(!0,i):a));s++);}n!==!!n&&(i=n,n=void 0);var a,o,l,s,d,f,v,p=0,c=at.body;if(t&&t!==c&&Q._.useKey>1&&(t=""+t===t?e(t)[0]:t.jquery?t[0]:t)){if(n){if(r(t._df,!0),!a)for(v=Ot?t.querySelectorAll(It):e(It,t).get(),f=v.length,l=0;!a&&f>l;l++)r(v[l]);return a}for(;t;){if(o=k(t,void 0,Gt))for(f=o.length;f--;)if(a=o[f],a.open){if(1>p)return a=nt[a.id],a&&i?a.get(i):a||Q;p--}else p++;t=t.previousSibling||t.parentNode}}return Q},link:O.link=c,unlink:O.unlink=N,cleanData:function(t){t.length&&Dt&&B(t),Pt.apply(e,arguments)}}),O.utility={validate:function(e){try{Q.link(void 0,at.createElement("div"),void 0,void 0,e,void 0,void 0,1)}catch(t){return t.message}}},st(e.fn,{link:function(e,t,n,i,r,a,o){return c(e,this,t,n,i,r,a,o)},unlink:function(e){return N(e,this)},view:function(e,t){return G(this[0],e,t)}}),e.each([ut,"replaceWith","empty","remove"],function(t,n){var i=e.fn[n];e.fn[n]=function(){var e;Dt=1;try{e=i.apply(this,arguments)}finally{Dt=0}return e}}),st(Q=ot.topView,{tmpl:{links:{}}}),nt={0:Q},lt({wrapMap:tt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},linkAttr:Y="data-link",merge:{input:{from:I,to:"value"},textarea:Mt,select:Mt,optgroup:{to:"label"}},jsrDbgMode:lt.debugMode,debugMode:function(e){lt.jsrDbgMode(e),rt._jsv=lt._dbgMode?{views:nt,bindings:Kt}:void 0},jsv:function(){lt.debugMode(lt._dbgMode),Y=lt.linkAttr,J=O._err,et=It+",["+Y+"]",it=lt.noDomLevel0,tt.optgroup=tt.option,tt.tbody=tt.tfoot=tt.colgroup=tt.caption=tt.thead,tt.th=tt.td}}),e)});
//# sourceMappingURL=jquery.views.min.js.map